<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA - Reconhecimento de Objetos</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark gradient-nav shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">
                <i class="bi bi-brain"></i> IA Reconhecimento de Objetos
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#info">Informações</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#about">Sobre</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid py-5">
        <!-- Hero Section -->
        <div class="row mb-5">
            <div class="col-lg-12">
                <div class="card border-0 shadow-lg hero-card">
                    <div class="card-body p-5 text-center">
                        <h1 class="card-title text-dark fw-bold mb-3">
                            <i class="bi bi-camera-video"></i> Reconhecedor de Objetos em Tempo Real
                        </h1>
                        <p class="card-text text-muted lead">
                            Utilize inteligência artificial para identificar objetos através da sua câmera
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Grid Layout -->
        <div class="row g-4">
            <!-- Camera Section -->
            <div class="col-lg-8 col-md-12">
                <div class="card border-0 shadow-lg h-100 camera-card">
                    <div class="card-header gradient-header text-white py-3">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-camera"></i> Câmera ao Vivo
                        </h5>
                    </div>
                    <div class="card-body d-flex flex-column align-items-center justify-content-center p-4">
                        <div id="webcam-container" class="webcam-wrapper rounded-3">
                            <!-- Webcam canvas will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Control Panel Section -->
            <div class="col-lg-4 col-md-12">
                <div class="card border-0 shadow-lg h-100 control-card">
                    <div class="card-header gradient-header-alt text-white py-3">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-sliders"></i> Controles
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <button type="button" class="btn btn-lg btn-success w-100 mb-3" onclick="init()" id="startBtn">
                            <i class="bi bi-play-circle"></i> Iniciar
                        </button>
                        <button type="button" class="btn btn-lg btn-danger w-100" onclick="stopWebcam()" id="stopBtn" disabled>
                            <i class="bi bi-stop-circle"></i> Parar
                        </button>
                        
                        <hr class="my-4">
                        
                        <div class="alert alert-info" id="statusAlert">
                            <i class="bi bi-info-circle"></i> Clique em "Iniciar" para começar
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="row g-4 mt-4">
            <div class="col-lg-12">
                <div class="card border-0 shadow-lg results-card">
                    <div class="card-header gradient-header text-white py-3">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-bar-chart"></i> Resultados da Análise
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div id="label-container" class="labels-grid">
                            <!-- Predictions will be inserted here -->
                        </div>
                        <div id="noLabelsMsg" class="text-center text-muted py-5">
                            <p>Nenhuma análise realizada ainda</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Section -->
        <div class="row g-4 mt-5" id="info">
            <div class="col-md-6">
                <div class="card border-0 shadow info-card">
                    <div class="card-body p-4">
                        <h5 class="card-title text-success fw-bold mb-3">
                            <i class="bi bi-lightbulb"></i> Como Funciona
                        </h5>
                        <ul class="list-unstyled">
                            <li class="mb-2"><strong>1.</strong> Clique em "Iniciar"</li>
                            <li class="mb-2"><strong>2.</strong> Permita acesso à câmera</li>
                            <li class="mb-2"><strong>3.</strong> Aponte para objetos</li>
                            <li><strong>4.</strong> Veja os resultados em tempo real</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card border-0 shadow info-card">
                    <div class="card-body p-4">
                        <h5 class="card-title text-primary fw-bold mb-3">
                            <i class="bi bi-shield-check"></i> Segurança & Privacidade
                        </h5>
                        <p class="card-text">
                            Seus dados são processados localmente no seu navegador. Nenhuma imagem é enviada para servidores externos.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-4 mt-5">
        <div class="container">
            <p class="mb-0">&copy; 2026 Reconhecedor de Objetos com IA. Desenvolvido com <i class="bi bi-heart-fill text-danger"></i></p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
        // More API functions here:
        // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image

        // the link to your model provided by Teachable Machine export panel
        const URL = "./";

        let model, webcam, labelContainer, maxPredictions;
        let isRunning = false;

        // Load the image model and setup the webcam
        async function init() {
            try {
                document.getElementById('statusAlert').innerHTML = '<i class="bi bi-hourglass-split"></i> Carregando modelo...';
                
                const modelURL = URL + "model.json";
                const metadataURL = URL + "metadata.json";

                // load the model and metadata
                // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
                // or files from your local hard drive
                // Note: the pose library adds "tmImage" object to your window (window.tmImage)
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();

                // Convenience function to setup a webcam
                const flip = true; // whether to flip the webcam
                webcam = new tmImage.Webcam(320, 320, flip); // width, height, flip
                await webcam.setup(); // request access to the webcam
                await webcam.play();
                isRunning = true;
                window.requestAnimationFrame(loop);

                // append elements to the DOM
                document.getElementById("webcam-container").innerHTML = '';
                document.getElementById("webcam-container").appendChild(webcam.canvas);
                labelContainer = document.getElementById("label-container");
                labelContainer.innerHTML = '';
                
                // Update buttons
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                
                document.getElementById('statusAlert').innerHTML = '<i class="bi bi-check-circle"></i> <strong>Modelo carregado!</strong> Análise em tempo real iniciada.';
                document.getElementById('noLabelsMsg').style.display = 'none';
                
                for (let i = 0; i < maxPredictions; i++) { // and class labels
                    labelContainer.appendChild(document.createElement("div"));
                }
            } catch (error) {
                document.getElementById('statusAlert').innerHTML = `<i class="bi bi-exclamation-circle"></i> Erro: ${error.message}`;
                document.getElementById('statusAlert').classList.remove('alert-info');
                document.getElementById('statusAlert').classList.add('alert-danger');
            }
        }

        async function loop() {
            if (isRunning) {
                webcam.update(); // update the webcam frame
                await predict();
                window.requestAnimationFrame(loop);
            }
        }

        async function predict() {
            // prediction
            const prediction = await model.predict(webcam.canvas);
            for (let i = 0; i < maxPredictions; i++) {
                const classPrediction = prediction[i].className + ": " + prediction[i].probability.toFixed(2);
                labelContainer.childNodes[i].innerHTML = classPrediction;
            }
        }

        function stopWebcam() {
            isRunning = false;
            if (webcam) {
                webcam.stop();
            }
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('statusAlert').innerHTML = '<i class="bi bi-pause-circle"></i> Câmera parada';
            document.getElementById('statusAlert').classList.remove('alert-info');
            document.getElementById('statusAlert').classList.add('alert-warning');
        }
    </script>

    async function loop() {
        webcam.update(); // update the webcam frame
        await predict();
        window.requestAnimationFrame(loop);
    }

    // run the webcam image through the image model
    async function predict() {
        // predict can take in an image, video or canvas html element
        const prediction = await model.predict(webcam.canvas);
        for (let i = 0; i < maxPredictions; i++) {
            const classPrediction =
                prediction[i].className + ": " + prediction[i].probability.toFixed(2);
            labelContainer.childNodes[i].innerHTML = classPrediction;
        }
    }
</script>

</body>
</html>